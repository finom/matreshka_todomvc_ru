{"version":3,"sources":["matreshka-router.min.js"],"names":["root","factory","define","amd","module","exports","require","Matreshka","this","MK","Router","type","Error","linkProps","onDebounce","on","set","win","window","extend","prototype","parts","path","hashPath","init","handleHashChange","_this","location","hash","hashEvent","handlePopStateChange","pathname","popEvent","initialized","document","v","fixed","replace","split","i","length","push","join","evt","value","prevValue","previousValue","equals","trigger","addEventListener","state","validPush","history","pushState","subscribe","obj","route","keys","changeEvents","filter","key","routeSilent","values","initRouter"],"mappings":"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","file":"matreshka-router.min.js","sourcesContent":["(function(root, factory) {\n\t/* istanbul ignore next */\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(['matreshka'], factory);\n\t} else if (typeof module === 'object' && module.exports) {\n\t\tmodule.exports = factory(require('matreshka'));\n\t} else {\n\t\tfactory(root.Matreshka);\n\t}\n}(this, function(MK) {\n\t\"use strict\";\n\n\t/* istanbul ignore if */\n\tif (!MK) {\n\t\tthrow Error('Matreshka is missing');\n\t}\n\n\tvar linkProps = MK.linkProps,\n\t\tonDebounce = MK.onDebounce,\n\t\ton = MK.on,\n\t\tset = MK.set,\n\t\twin = typeof window != 'undefined' ? window : null;\n\n\tfunction Router(type) {\n\t\t// singletone pattern for history and hash router\n\t\tif (type in Router) {\n\t\t\treturn Router[type];\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tMK.extend(Router.prototype, {\n\t\tparts: [],\n\t\tpath: '/',\n\t\thashPath: '!#/',\n\t\tinit: function() {\n\t\t\tif (this.initialized) return this;\n\n\t\t\tvar _this = this,\n\t\t\t\ttype = _this.type,\n\t\t\t\tlocation = document.location;\n\n\t\t\tfunction handleHashChange() {\n\t\t\t\tset(_this, 'hashPath', location.hash, {\n\t\t\t\t\thashEvent: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction handlePopStateChange() {\n\t\t\t\tset(_this, 'path', location.pathname, {\n\t\t\t\t\tpopEvent: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlinkProps(_this, 'parts', 'path', function(v) {\n\t\t\t\tvar fixed = v.replace(/\\/\\//g, '/')\n\t\t\t\t\t.replace(/^\\/|\\/$/g, '');\n\n\t\t\t\treturn fixed ? fixed.split('/') : [];\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'path', 'parts', function(v) {\n\t\t\t\tvar parts = [],\n\t\t\t\t\ti;\n\n\t\t\t\tfor (i = 0; i < v.length; i++) {\n\t\t\t\t\tif (v[i]) {\n\t\t\t\t\t\tparts.push(v[i]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn parts.length ? ('/' + parts.join('/') + '/') : '/';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'hashPath', 'path', function(v) {\n\t\t\t\treturn v && v != '/' ? '#!' + v : '';\n\t\t\t});\n\n\t\t\tlinkProps(_this, 'path', 'hashPath', function(v) {\n\t\t\t\treturn v ? v.replace(/^#!/, '') : '';\n\t\t\t});\n\n\t\t\ton(_this, 'change:parts', function(evt) {\n\t\t\t\tvar value = evt.value,\n\t\t\t\t\tprevValue = evt.previousValue,\n\t\t\t\t\tequals = value.length == prevValue.length,\n\t\t\t\t\ti;\n\n\t\t\t\tif (equals) {\n\t\t\t\t\tfor (i = 0; i < value.length; i++) {\n\t\t\t\t\t\tif (value[i] != prevValue[i]) {\n\t\t\t\t\t\t\tequals = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!equals) {\n\t\t\t\t\tMK.trigger(_this, 'pathchange');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (win) {\n\t\t\t\tif (type == 'hash') {\n\t\t\t\t\thandleHashChange();\n\n\t\t\t\t\twin.addEventListener('hashchange', handleHashChange);\n\n\t\t\t\t\tonDebounce(_this, 'change:hashPath', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.hashEvent) {\n\t\t\t\t\t\t\tlocation.hash = _this.hashPath;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t} else if (type == 'history') {\n\t\t\t\t\thandlePopStateChange();\n\n\t\t\t\t\twin.addEventListener('popstate', function(evt) {\n\t\t\t\t\t\tif (evt.state && evt.state.validPush) {\n\t\t\t\t\t\t\thandlePopStateChange();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tonDebounce(_this, 'change:path', function(evt) {\n\t\t\t\t\t\tif (!evt || !evt.popEvent) {\n\t\t\t\t\t\t\thistory.pushState({\n\t\t\t\t\t\t\t\tvalidPush: true\n\t\t\t\t\t\t\t}, '', _this.path + location.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_this.initialized = true;\n\n\t\t\treturn _this;\n\n\t\t},\n\t\tsubscribe: function(obj, route) {\n\t\t\tvar _this = this.init(),\n\t\t\t\tkeys = route.replace(/\\/\\//g, '/').replace(/^\\/|\\/$/g, '').split('/'),\n\t\t\t\tchangeEvents = [],\n\t\t\t\tfilteredKeys = keys.filter(function(key) {\n\t\t\t\t\treturn key != '*';\n\t\t\t\t}),\n\t\t\t\tparts = [],\n\t\t\t\ti;\n\n\t\t\tfor(i = 0; i < keys.length; i++) {\n\t\t\t\tif(keys[i] != '*') {\n\t\t\t\t\tchangeEvents.push('change:' + keys[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ton(obj, changeEvents, function(evt) {\n\t\t\t\tif (evt && evt.routeSilent) return;\n\n\t\t\t\tvar values = [],\n\t\t\t\t\ti,\n\t\t\t\t\tvalue;\n\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tvalue = keys[i] == '*' ? _this.parts[i] : obj[keys[i]];\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tvalues.push(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_this.parts = values;\n\t\t\t});\n\n\t\t\ton(_this, 'pathchange', function() {\n\t\t\t\tvar i;\n\t\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\t\tif (keys[i] != '*') {\n\t\t\t\t\t\tset(obj, keys[i], _this.parts[i] || null, {\n\t\t\t\t\t\t\trouteSilent: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\tparts.push(obj[keys[i]] == '*' ? _this.parts[i] : obj[keys[i]] || _this.parts[i]);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\tif(typeof obj[keys[i]] == 'undefined' && _this.parts[i] && obj[keys[i]] != '*') {\n\t\t\t\t\tobj.set(keys[i], _this.parts[i], {\n\t\t\t\t\t\trouteSilent: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_this.parts = parts;\n\n\t\t\treturn _this;\n\t\t}\n\t});\n\n\tMK.Router = Router;\n\tMK.Router.history = new Router('history');\n\tMK.Router.hash = new Router('hash');\n\n\tMK.initRouter = function(obj, route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(obj, route);\n\t\treturn obj;\n\t};\n\n\tMK.prototype.initRouter = function(route, type) {\n\t\tMK.Router[type || 'hash'].subscribe(this, route);\n\t\treturn this;\n\t};\n\n\treturn Router;\n}));\n"],"sourceRoot":"/source/"}